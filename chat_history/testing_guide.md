# 更新功能测试指南 (开发版)

由于自动更新功能依赖于**本地版本**与**服务器版本**的比对，您不需要立即发布新版本即可进行测试。请按照以下步骤操作：

## 1. 消除编译警告 (已完成)
您提到的警告 `Use multi-arg instead` 是 Qt 推荐的性能优化写法。
我刚刚已经将 `src/updater/main.cpp` 中的 `.arg(a).arg(b)` 修改为更高效的 `.arg(a, b)`，这应该会消除该警告。

## 2. 测试自动更新流程 (无需发布)

核心思路：**将本地版本号“伪装”成旧版本**，让程序误以为服务器上的版本（假设是 1.0.0 或更高）是新版本。

### 步骤 A: 确认服务器版本
程序目前连接的更新地址是：`http://47.101.52.0/updates/version.json`
如果该服务器尚未部署，您可以使用本地搭建的测试服务器（见下文步骤 C）。
如果该服务器已有内容（比如版本号写的是 `1.0.0`），则继续步骤 B。

### 步骤 B: 修改本地版本号 (降级)
我们需要让本地运行的程序认为自己是“旧版”。

1. 打开项目根目录下的 `version_info.json` 文件：
   `c:\Users\admin\Desktop\trae\DeskCare\version_info.json`
2. 将版本号改低，例如改为 **0.0.1**：
   ```json
   {
       "major": 0,
       "minor": 0,
       "patch": 1
   }
   ```
3. **重新运行程序** (无需重新编译 C++ 代码，因为 Version.cpp 是动态读取该 JSON 文件的)。
4. 此时程序启动时会读取到自己是 `0.0.1`，并向服务器查询。如果服务器返回的是 `1.0.0`，程序就会触发“发现新版本”的流程（图标呼吸闪烁）。
5. 点击刷新图标，测试下载和安装流程。

### 步骤 C: (可选) 搭建本地测试服务器
如果您无法控制远程服务器，可以在本地模拟一个。

1. 在电脑任意位置新建文件夹 `local_server`。
2. 在其中放入 `version.json` (内容为版本 1.0.0) 和一个随便打包的 zip 文件 (命名为 update.zip)。
3. 在该文件夹打开终端，运行 `python -m http.server 8000`。
4. 修改 `src/core/UpdateManager.cpp` 中的 `UPDATE_URL` 为 `http://localhost:8000/version.json`。
5. 重新编译并运行。

---

### 验证点 checklist
- [ ] 启动后，右下角刷新图标是否变成绿色并开始呼吸？
- [ ] 点击图标是否弹出确认对话框？
- [ ] 点击“立即更新”后，是否有进度条显示？
- [ ] 下载完成后，主程序是否自动关闭？
- [ ] 更新程序 (Updater窗口) 是否出现并解压文件？
- [ ] 更新完成后，主程序是否自动重启？

测试完成后，记得将 `version_info.json` 改回实际开发版本 (如 1.0.1)。
